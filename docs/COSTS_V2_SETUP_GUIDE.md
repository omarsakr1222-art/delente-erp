# ๐ ุฏููู ูุธุงู Costs V2 - ุงูุชูุงููู ุงููุชูุฏู

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ุชู ุจูุงุก ูุธุงู **Costs V2** ูุตูุญุฉ ูุณุชููุฉ ุชูุงูุงู ุจุฌุงูุจ ุงููุธุงู ุงููุฏููุ ูุน ุงูุญูุงุธ ุนูู ูุงูู ุงูููุฏ ุงููุณุชูุฑ ุงูููุฌูุฏ.

### ๐ ูุง ูู ุฌุฏูุฏ:

โ **ุตูุญุฉ ูุณุชููุฉ** - ูุนุฒููุฉ ุชูุงูุงู ุนู ุงููุธุงู ุงููุฏูู  
โ **5 ููุงุธุฑ ุฏุงุฎููุฉ ูุงููุฉ** - Dashboard, Price Grid, Recipes, Batches, Reports  
โ **ุฑุจุท ุญู ูุน Stock Control** - ูุฑุงุกุฉ ุชููุงุฆูุฉ ูู products collection  
โ **UX ูุญุณูู** - onfocus="this.select()" ุนูู ุฌููุน ุงูุฃุฑูุงู  
โ **ูุงุฌูุฉ ุงุญุชุฑุงููุฉ** - Tailwind CSS + Lucide Icons  

---

## ๐ ุงููููุงุช ุงููุถุงูุฉ/ุงููุนุฏููุฉ

### 1๏ธโฃ ููู Logic (ุฌุฏูุฏ ุจุงููุงูู)
```
e:\delente-erp\js\costs-v2-logic.js
```
- **ุงูุญุฌู**: ~400 ุณุทุฑ
- **ุงููุธููุฉ**: ูู ุงูููุทู ุงูุนููู ูููุธุงู
- **ุงูุงุณุชููุงููุฉ**: ูุนุฒูู ุชูุงูุงู ุนู ุงูุฃูุธูุฉ ุงูุฃุฎุฑู

### 2๏ธโฃ ุตูุญุฉ HTML (ูุญุฏูุซุฉ)
```
e:\delente-erp\index.html (lines 2873-3260)
```
- **ุงููููุน**: ูุณู `page-costs-v2` ูุณุชูู
- **IDs**: ุฌููุน ุงูุนูุงุตุฑ ุชุจุฏุฃ ุจู `v2-` ูุถูุงู ุนุฏู ุงูุชุฏุงุฎู
- **ุงููุฆุงุช**: ูู ูุณู ูู ุงุณู ูุชูุฑูุฏ `v2-view-*`

---

## ๐๏ธ ุงูุจููุฉ ุงูุฏุงุฎููุฉ

### ุงูููุงุธุฑ ุงูุฎูุณุฉ (5 Views):

```
1๏ธโฃ Dashboard (ุงูุฑุฆูุณูุฉ)
   โโ ุฅุฌูุงูู ุงูุฃุฑุจุงุญ ุงูุดูุฑูุฉ
   โโ ุนุฏุฏ ุงูุชุดุบููุงุช ุงููุดุทุฉ
   โโ ุฑุณุงูุฉ ุชุฑุญูุจูุฉ

2๏ธโฃ Price Grid (ุดุจูุฉ ุงูุฃุณุนุงุฑ)
   โโ ุฌุฏูู ุจูู ุงูุฎุงูุงุช ูุงูุชุบููู ูู Stock Control
   โโ ุชุญุฏูุซ ุชููุงุฆู ุนูุฏ ุชุบููุฑ ุงูุฃุณุนุงุฑ
   โโ ููุชุฑ ุจู 3 ูุฆุงุช: ุฎุงูุงุชุ ุชุบูููุ ุฅูุชุงุฌ ุชุงู

3๏ธโฃ Recipes (ุงููุตูุงุช/BOM)
   โโ ุฅูุดุงุก ูุตูุงุช ุฌุฏูุฏุฉ
   โโ ุงุฎุชูุงุฑ ุงูุฎุงูุงุช ูุงูููุงุฏูุฑ
   โโ ุญุณุงุจ ุงูุชูููุฉ ุงูุชูุฏูุฑูุฉ ุชููุงุฆูุงู
   โโ ุนุฑุถ ูุงุฆูุฉ ุงููุตูุงุช ุจุงูููุงูุด ุงูุฑุจุญูุฉ

4๏ธโฃ Batches (ุงูุชุดุบููุงุช)
   โโ ุงูุชุดุบููุงุช ุงูุฌุงุฑูุฉ (ุชุญุช ุงูุฅูุชุงุฌ)
   โโ ุงูุชุดุบููุงุช ุงูููุชููุฉ (ูุน ุงูุฃุฑุจุงุญ)
   โโ ุฅุบูุงู ุชุดุบููุฉ ูุชุณุฌูู ุงูู Yield
   โโ ุญุณุงุจ ุชูููุฉ ุงููุญุฏุฉ ุงููุนููุฉ

5๏ธโฃ Reports (ุงูุชูุงุฑูุฑ)
   โโ ุฌุฏูู ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ
   โโ ุญุณุงุจ ุงููุงูุด ุงูุฑุจุญู (%)
   โโ ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช ูุงูุชูุงููู
   โโ ุชูุงุตูู ูู ุชุดุบููุฉ
```

---

## ๐ ุงูุฑุจุท ูุน Stock Control (Live Bridge)

### โก ููููุฉ ุงูุนูู:

```javascript
// ูุฑุงุกุฉ ูู products collection
db.collection('products').onSnapshot(snap => {
    snap.docs.forEach(doc => {
        const p = doc.data();
        
        // ููุชุฑ ุงููุฆุงุช (ุญุณุงุณ ููุญุงูุฉ)
        if (category.includes('ุฎุงูุฉ')) โ ingredientsMap
        if (category.includes('ุชุบููู')) โ packagingMap
        
        // ุชุญุฏูุซ ุงูุฌุฏูู ุชููุงุฆูุงู
    });
});
```

### ๐ ุงูุจูุงูุงุช ุงูููุฑูุกุฉ ูู ูู ููุชุฌ:

| ุงูุญูู | ุงููุตู |
|------|-------|
| `name` | ุงุณู ุงูุตูู |
| `category` | ุงููุฆุฉ (ุฎุงูุฉุ ุชุบูููุ ุฅูุชุงุฌ ุชุงู) |
| `unit` | ูุญุฏุฉ ุงูููุงุณ (ูุฌูุ ูุชุฑุ ุฅูุฎ) |
| `avgCost` | ูุชูุณุท ุณุนุฑ ุงูุดุฑุงุก |
| `currentStock` | ุงููููุฉ ุงููุชุงุญุฉ ุงูุขู |

---

## ๐จ UX Improvements (ุชุญุณููุงุช ุงูุชุฌุฑุจุฉ)

### โจ Auto-Select on Focus
```html
<!-- ุฌููุน input[type="number"] ูุฏููุง: -->
<input type="number" onfocus="this.select()" ... />
```
**ุงููุชูุฌุฉ**: ุนูุฏ ุงูุถุบุท ุนูู ุงูุญููุ ููุฎุชุงุฑ ุงููุต ุชููุงุฆูุงู โ ูุชุงุจุฉ ุณุฑูุนุฉ

### ๐งน Clear Input Fields
- ุจุฏูู placeholder="0" ุฃู ุฃุดูุงุก ูุฑุชุจูุฉ
- ุชุจุฏุฃ ุฌููุน ุงูุญููู ุจู empty ุฃู 0
- ูุง ุชูุฌุฏ ุฑุณุงุฆู "ุฌุงุฑู ุงูุชุญููู" ูุฑุฆูุฉ (hidden state ููุท)

### ๐ฏ Unique IDs (ุนุฒู ูุงูู)
ุฌููุน ุงูุนูุงุตุฑ ุชุณุชุฎุฏู ุงูุจุงุฏุฆุฉ `v2-`:
- `v2-view-*` ููููุงุธุฑ
- `v2-modal-*` ููููุงูุฐ ุงูููุจุซูุฉ
- `v2-*-form` ููููุงุฐุฌ
- `v2-*-tbody` ููุฌุฏุงูู

**ุงููุงุฆุฏุฉ**: ูุง ุชูุฌุฏ ููุทุฉ ุงุญุชูุงู ูุน ุงููุธุงู ุงููุฏูู

---

## ๐ง ุงูุชูุงูู ุงูููู

### Firebase Collections ุงููุณุชุฎุฏูุฉ:

```javascript
const COLL_PRODUCTS = 'products';
const COLL_RECIPES = 'artifacts/{appId}/public/data/recipes';
const COLL_BATCHES = 'artifacts/{appId}/public/data/batches';
const COLL_SALES = 'artifacts/{appId}/public/data/batch_sales';
```

### Listeners Management (ููุน ูุฒูู ุงูุจูุงูุงุช):

```javascript
// ุชุฎุฒูู ุฌููุน ุงูู unsubscribe functions
window.storeSubscription('view-name', unsub);

// ุนูุฏ ุชุบููุฑ ุงูุตูุญุฉ:
// ูุชู ุฅูุบุงุก ุงูู listener ุชููุงุฆูุงู
```

### Permission Checks:

- โ ูุณุชุฎุฏู `getUserRole() === 'admin'` ูู ุงููุธุงู ุงููุฏูู
- โ ูุง ูููู ุฏุฎูู ุงูุตูุญุฉ ุจุฏูู ุตูุงุญูุงุช Admin

---

## ๐ ุฎุทูุงุช ุงูุงุณุชุฎุฏุงู

### 1๏ธโฃ ุงูุฏุฎูู ููุตูุญุฉ:
```
ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ โ ุงุถุบุท ุนูู "ุชูุงููู V2"
```

### 2๏ธโฃ ุฅุถุงูุฉ ุฎุงูุงุช (ูู Stock Control):
```
1. ุงูุชูู ูู Stock Control
2. ุฃุถู ููุชุฌุงุช ุจูุฆุฉ "ุฎุงูุฉ" ุฃู "ุชุบููู"
3. ุนูุฏุฉ ููุชูุงููู โ ุดุจูุฉ ุงูุฃุณุนุงุฑ ุณุชุธูุฑ ุชููุงุฆูุงู
```

### 3๏ธโฃ ุฅูุดุงุก ูุตูุฉ:
```
ุงููุตูุงุช โ ุงุถุบุท "ูุตูุฉ ุฌุฏูุฏุฉ" โ ุงููุฃ ุงูุจูุงูุงุช:
  - ุงุณู ุงูููุชุฌ
  - ุงููุญุฏุฉ
  - ุงุฎุชุฑ ุงูุฎุงูุงุช ูุงูููุงุฏูุฑ
  - ุฃุถู ูุตุงุฑูู ุงูุชุดุบูู
  - ุญุฏุฏ ุณุนุฑ ุงูุจูุน
โ ุญูุธ ูุงุนุชูุงุฏ
```

### 4๏ธโฃ ุฅูุดุงุก ุชุดุบููุฉ:
```
ุงูุชุดุบููุงุช โ ุญุฏุฏ ูุตูุฉ โ ุงุจุฏุฃ ุงูุชุดุบูู
```

### 5๏ธโฃ ุฅุบูุงู ุงูุชุดุบููุฉ:
```
ุนูุฏ ุงูุชูุงุก ุงูุฅูุชุงุฌ:
  - ุฃุฏุฎู ุงูุชูููุฉ ุงููุนููุฉ
  - ุฃุฏุฎู ุงูู Yield (ุงููููุฉ ุงูููุชุฌุฉ)
  - ุงุนุชูุงุฏ ุงูุฅุบูุงู
```

### 6๏ธโฃ ูุฑุงุฌุนุฉ ุงูุชูุงุฑูุฑ:
```
ุงูุชูุงุฑูุฑ โ ุนุฑุถ P&L ููู ุชุดุบููุฉ
           โ ุญุณุงุจ ุงููุงูุด ุงูุฑุจุญู (%)
           โ ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช ูุงูุชูุงููู
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### โ ุงูุดุจูุฉ ูุงุฑุบุฉ (ูุง ุชุธูุฑ ุฎุงูุงุช)

**ุงูุญู**:
1. ุชุฃูุฏ ูู ุฅุถุงูุฉ ููุชุฌุงุช ูู Stock Control
2. ุชุฃูุฏ ุฃู ุงููุฆุฉ ุชุญุชูู ุนูู ูููุฉ "ุฎุงูุฉ" ุฃู "ุชุบููู"
3. ุงูุชุญ Console (F12) ูุชุญูู ูู ุงูุฃุฎุทุงุก

### โ ุงูุฃุฑูุงู ูุง ุชูุญุณุจ ุชููุงุฆูุงู

**ุงูุญู**:
1. ุชุฃูุฏ ูู ุงูุถุบุท ุนูู ุฒุฑ "ุฅุถุงูุฉ ูููู"
2. ุงุฎุชุฑ ุงูุฎุงูุฉ ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ
3. ุฃุฏุฎู ุงูููุฏุงุฑ
4. ุงูุญุณุงุจ ูุชู ุชููุงุฆูุงู

### โ ูุง ุชุธูุฑ ุงูุชูุงุฑูุฑ

**ุงูุญู**:
1. ุชุฃูุฏ ูู ุฅุบูุงู ุชุดุบููุงุช (Status = "closed")
2. ุชุฃูุฏ ูู ุชุณุฌูู ูุจูุนุงุช ูู ุงูุชุดุบููุฉ
3. ุงูุชุธุฑ ุซุงููุฉ - ุงูุจูุงูุงุช ุชุชุญุฏุซ ูู ุงูููุช ุงููุนูู

---

## ๐ ุงููููุงุช ุงููุตุฏุฑ (Source Code)

### ุชูุงุตูู ุงูู JavaScript:

| ุงูุฏุงูุฉ | ุงููุตู |
|------|-------|
| `switchCostsView(viewName)` | ุชุจุฏูู ุจูู ุงูููุงุธุฑ |
| `loadPrices()` | ูุฑุงุกุฉ ุงูุฎุงูุงุช ูู products |
| `loadRecipes()` | ุนุฑุถ ูุงุฆูุฉ ุงููุตูุงุช |
| `loadBatches()` | ุนุฑุถ ุงูุชุดุบููุงุช ุงููุดุทุฉ ูุงูููุชููุฉ |
| `loadReports()` | ุญุณุงุจ P&L |
| `calcRecipeCost()` | ุญุณุงุจ ุชูููุฉ ุงููุตูุฉ ุงูุญูุฉ |
| `saveRecipe(e)` | ุญูุธ ูุตูุฉ ุฌุฏูุฏุฉ |
| `closeBatch(e)` | ุฅุบูุงู ุชุดุบููุฉ |
| `init()` | ุชููุฆุฉ ุงููุธุงู ุนูุฏ ุงูุชุญููู |

### ุชูุงุตูู ุงูู HTML:

| ุงููุนุฑูู | ุงููุตู |
|--------|-------|
| `page-costs-v2` | ุงูุญุงููุฉ ุงูุฑุฆูุณูุฉ |
| `v2-view-*` | ููุงุธุฑ ุงูุตูุญุงุช ุงูุฎูุณุฉ |
| `v2-modal-*` | ุงูููุงูุฐ ุงูููุจุซูุฉ (recipe, close-batch, sale) |
| `v2-*-tbody` | ุฌุฏุงูู ุงูุจูุงูุงุช |
| `v2-*-grid` | ุดุจูุงุช ุงูุญุงููุงุช |

---

## โ ููุงุท ุงูุชุญูู (Checklist)

ูุจู ุงูุฅุทูุงูุ ุชุฃูุฏ ูู:

- [ ] โ ุตูุญุฉ ุงูุชูุงููู V2 ุชุธูุฑ ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
- [ ] โ ุงูุฏุฎูู ูุชุทูุจ ุตูุงุญูุงุช Admin
- [ ] โ ุงูุงูุชูุงู ุจูู ุงูููุงุธุฑ ูุนูู ุจุฏูู ุชุฃุฎูุฑ
- [ ] โ ุดุจูุฉ ุงูุฃุณุนุงุฑ ุชุนุฑุถ ุงูุฎุงูุงุช ูุงูุชุบููู
- [ ] โ ุฅูุดุงุก ูุตูุฉ ูุญุณุจ ุงูุชูููุฉ ุชููุงุฆูุงู
- [ ] โ ุฅูุดุงุก ุชุดุบููุฉ ูุฑุจุท ุงููุตูุฉ ุตุญูุญุงู
- [ ] โ ุฅุบูุงู ุงูุชุดุบููุฉ ูุญุณุจ ุชูููุฉ ุงููุญุฏุฉ
- [ ] โ ุงูุชูุงุฑูุฑ ุชุนุฑุถ ุงูุฃุฑุจุงุญ ุจุดูู ุตุญูุญ
- [ ] โ Onfocus ูุฎุชุงุฑ ุงููุต ุชููุงุฆูุงู ูู ุงูุฃุฑูุงู
- [ ] โ ูุง ุชูุฌุฏ ุฑุณุงุฆู "ุฌุงุฑู ุงูุชุญููู" ูุฑุฆูุฉ
- [ ] โ ูุง ูุฌูุฏ ุชุฏุงุฎู CSS ูุน ุงูุตูุญุงุช ุงูุฃุฎุฑู

---

## ๐ ุงููุณุฎุฉ ุงูุญุงููุฉ

**v2.1 - Professional Edition**

- โ Standalone System (ูุนุฒูู ุชูุงูุงู)
- โ 5 Internal Views (ููุงุธุฑ ูุชูุงููุฉ)
- โ Live Stock Bridge (ุฑุจุท ูุจุงุดุฑ)
- โ Enhanced UX (ุชุฌุฑุจุฉ ูุญุณููุฉ)
- โ Production-Ready Code (ุงุญุชุฑุงูู ูุฌุงูุฒ)

---

## ๐ ุงูุฏุนู ุงูููู

ูุฃู ุงุณุชูุณุงุฑุงุช ุฃู ูุดุงูู:
1. ุงูุชุญ Console (F12)
2. ุงุจุญุซ ุนู ุงูุฃุฎุทุงุก ุงูุญูุฑุงุก
3. ุชุญูู ูู ุงููุงุฆูุฉ ุฃุนูุงู
4. ูู ุงูุญุงูุงุช ุงูุทุงุฑุฆุฉ: ุชูุงุตู ูุน ูุฑูู ุงูุชุทููุฑ

---

## ๐ ููุงุญุธุงุช ุงููุทูุฑ

### ูููู ุงูุจูุงูุงุช ุงููุชููุน:

**products (ูู Stock Control)**:
```json
{
  "id": "prod-123",
  "name": "ุญููุจ",
  "category": "ุฎุงูุฉ",
  "unit": "ูุชุฑ",
  "avgCost": 15.5,
  "currentStock": 100
}
```

**recipes (ุฌุฏูุฏ)**:
```json
{
  "id": "rec-123",
  "name": "ุฌุจูุฉ ูุฑูุด",
  "unit": "ููุณ",
  "ingredients": [
    {"id": "prod-123", "qty": 5}
  ],
  "overhead": 50,
  "stdPrice": 80,
  "estimatedCost": 127.5
}
```

**batches (ุฌุฏูุฏ)**:
```json
{
  "id": "batch-123",
  "batchNumber": 1,
  "recipeId": "rec-123",
  "estimatedCost": 127.5,
  "status": "closed",
  "finalQty": 10,
  "unitCost": 12.75
}
```

---

**ุขุฎุฑ ุชุญุฏูุซ**: 14 ููุงูุฑ 2026  
**ุงูุญุงูุฉ**: โ ุฌุงูุฒ ููุฅูุชุงุฌ (Production Ready)
